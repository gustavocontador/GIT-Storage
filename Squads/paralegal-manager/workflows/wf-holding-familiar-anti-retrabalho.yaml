# wf-holding-familiar-anti-retrabalho.yaml
# Workflow: Holding Familiar com Framework Anti-Retrabalho Cart√≥rios
# Owner: holding-familiar-agent
# Duration: 30-60 dias (fases n√£o simult√¢neas)
# Criticality: HIGH (problema #2 mais cr√≠tico - 100% retrabalho ‚Üí 20%)

name: "Holding Familiar - Framework Anti-Retrabalho"
id: wf-holding-familiar-anti-retrabalho
version: "2.0.0"
owner: holding-familiar-agent
type: paralegal-workflow
duration_days: 45
complexity: high

description: |
  Workflow completo para constitui√ß√£o de Holding Familiar com transfer√™ncia de im√≥veis.
  DIFERENCIAL: Framework Anti-Retrabalho (3 fases) que reduz retrabalho de 100% para 20%.

  PROBLEMA RESOLVIDO:
  Cart√≥rios n√£o uniformizados causavam 100% de retrabalho (refazer documentos).
  Cada cart√≥rio exige documentos diferentes, formatos diferentes, certid√µes diferentes.

  SOLU√á√ÉO:
  FASE 1 - Mapeamento: Identificar TODOS cart√≥rios ANTES protocolar
  FASE 2 - Uniformiza√ß√£o: Padronizar docs por requisitos de cada cart√≥rio
  FASE 3 - Protocolo Simult√¢neo: Protocolar TODOS no MESMO DIA

golden_rule: |
  REGRA DE OURO: NUNCA protocolar em cart√≥rio sem mapear TODOS os outros cart√≥rios primeiro.

phases:
  - phase: 1
    name: "Mapeamento Pr√©-Protocolo"
    duration_days: 7
    objective: "Identificar TODOS cart√≥rios envolvidos e requisitos espec√≠ficos"

    steps:
      - id: step_1
        name: "Invent√°rio de Im√≥veis"
        responsible: holding-familiar-agent
        duration_days: 2
        actions:
          - "Listar TODOS im√≥veis da fam√≠lia:"
          - "  - Endere√ßo completo"
          - "  - Matr√≠cula (n√∫mero + cart√≥rio registro)"
          - "  - Propriet√°rio atual (CPF)"
          - "  - Valor venal (IPTU)"
          - "Validar: im√≥vel quitado ou financiado?"
        output: "Planilha: N im√≥veis √ó dados completos"
        alert: |
          SE im√≥vel financiado (ainda pagando banco):
          ENT√ÉO precisa anu√™ncia banco ANTES transferir para holding.
          Bancos podem bloquear ou exigir quita√ß√£o antecipada.

      - id: step_2
        name: "Mapeamento Cart√≥rios"
        responsible: holding-familiar-agent
        duration_days: 1
        dependencies: [step_1]
        actions:
          - "Por matr√≠cula, identificar cart√≥rio registro:"
          - "  - Im√≥vel 1: Cart√≥rio X (cidade A)"
          - "  - Im√≥vel 2: Cart√≥rio Y (cidade B)"
          - "  - Im√≥vel 3: Cart√≥rio X (cidade A) - mesmo que im√≥vel 1"
          - "Resultado: N im√≥veis ‚Üí M cart√≥rios √∫nicos"
        output: "Lista de cart√≥rios √∫nicos envolvidos (pode ser 1, pode ser 5+)"
        example: |
          Cliente com 5 im√≥veis:
          - 3 im√≥veis: Cart√≥rio 1¬∫ Of√≠cio S√£o Paulo
          - 1 im√≥vel: Cart√≥rio 2¬∫ Of√≠cio Guarulhos
          - 1 im√≥vel: Cart√≥rio √önico Santo Andr√©
          TOTAL: 3 cart√≥rios diferentes

      - id: step_3
        name: "Consulta Requisitos POR Cart√≥rio"
        responsible: holding-familiar-agent
        duration_days: 4
        dependencies: [step_2]
        actions:
          - "Para CADA cart√≥rio identificado:"
          - "  1. Ligar/visitar cart√≥rio"
          - "  2. Perguntar: 'Para transferir im√≥vel para holding, quais docs exigem?'"
          - "  3. Documentar requisitos espec√≠ficos:"
          - "     - Reconhecimento firma? SIM/N√ÉO"
          - "     - Apostilamento? SIM/N√ÉO"
          - "     - Certid√µes: quais? (casamento, nascimento, √≥bito?)"
          - "     - Formato contrato social: autenticado? registrado?"
          - "     - ITBI: c√°lculo pr√©vio obrigat√≥rio?"
        output: "Matriz: Cart√≥rio √ó Requisitos Espec√≠ficos"
        critical: |
          CADA CART√ìRIO √â UM FEUDO INDEPENDENTE.
          Cart√≥rio A exige X, Cart√≥rio B N√ÉO ACEITA X.
          Essa incompatibilidade √© a RAIZ do retrabalho.

        exemplo_matriz: |
          | Cart√≥rio | Reconh. Firma | Apostila | Cert. Casamento | ITBI Pr√©vio |
          |----------|---------------|----------|-----------------|-------------|
          | 1¬∫ SP    | SIM           | N√ÉO      | SIM (< 90d)     | SIM         |
          | 2¬∫ Guar  | N√ÉO           | SIM      | SIM (< 60d)     | N√ÉO         |
          | √önico SA | SIM           | SIM      | SIM (< 90d)     | SIM         |

  - phase: 2
    name: "Uniformiza√ß√£o Documental"
    duration_days: 15
    objective: "Criar pacote documentos v√°lido para TODOS cart√≥rios"

    steps:
      - id: step_4
        name: "Constitui√ß√£o Holding (Junta Comercial)"
        responsible: junta-comercial-agent
        duration_days: 5
        actions:
          - "Criar empresa holding (LTDA ou SA)"
          - "Nome: '[Sobrenome] Holding Ltda' ou '[Nome] Participa√ß√µes'"
          - "Objeto social: 'Participa√ß√£o em outras sociedades'"
          - "S√≥cios: membros fam√≠lia (quotas por %)  "
          - "Capital social: soma valor im√≥veis (ou simb√≥lico R$ 10k)"
          - "Registrar Junta Comercial ‚Üí NIRE"
        output: "Contrato social holding registrado + NIRE + CNPJ"
        cost: "R$ 1.000 - R$ 3.000"

      - id: step_5
        name: "Coleta Certid√µes (Todas Necess√°rias)"
        responsible: certidoes-compliance-agent
        duration_days: 5
        dependencies: [step_3]
        actions:
          - "Baseado na Matriz Requisitos (step_3), coletar:"
          - "  - Certid√µes nascimento (todos s√≥cios)"
          - "  - Certid√µes casamento (se casados, validade < menor prazo matriz)"
          - "  - Certid√µes √≥bito (se vi√∫vos)"
          - "  - Certid√µes matr√≠cula im√≥veis (20 anos √¥nus)"
          - "  - Certid√µes negativas (RFB, estadual, municipal)"
          - "SE qualquer cart√≥rio exige apostila ‚Üí apostilar TODAS certid√µes"
          - "SE qualquer cart√≥rio exige reconhecimento ‚Üí reconhecer TODOS docs"
        output: "Dossi√™ certid√µes completo, v√°lido para TODOS cart√≥rios"
        cost: "R$ 50-200 por certid√£o √ó N certid√µes (pode ser 15-30 certid√µes)"
        strategy: |
          UNIFORMIZAR PELO MAIS RESTRITIVO:
          SE Cart√≥rio A exige validade < 60 dias E Cart√≥rio B aceita < 90 dias
          ENT√ÉO emitir < 60 dias (atende ambos)

      - id: step_6
        name: "C√°lculo ITBI (Imposto Transmiss√£o)"
        responsible: holding-familiar-agent
        duration_days: 3
        dependencies: [step_3, step_4]
        actions:
          - "Para CADA im√≥vel:"
          - "  - Valor venal (IPTU) ou valor mercado (maior)"
          - "  - Al√≠quota ITBI munic√≠pio (geralmente 2-3%)"
          - "  - C√°lculo: ITBI = valor √ó al√≠quota"
          - "SE munic√≠pio exige c√°lculo pr√©vio ‚Üí protocolar antes transfer√™ncia"
          - "Somar ITBI todos im√≥veis = custo fiscal total"
        output: "Planilha ITBI + guias pagamento (se pr√©vio)"
        alert: |
          ITBI PODE SER SURPRESA CARA:
          5 im√≥veis √ó R$ 500k cada √ó 3% ITBI = R$ 75.000
          Cliente DEVE SABER custo fiscal ANTES prosseguir.

      - id: step_7
        name: "Prepara√ß√£o Documentos Uniformizados"
        responsible: holding-familiar-agent
        duration_days: 5
        dependencies: [step_4, step_5, step_6]
        actions:
          - "Gerar escrituras transfer√™ncia im√≥veis:"
          - "  - Formato aceito por TODOS cart√≥rios"
          - "  - SE conflito (Cart√≥rio A quer X, B n√£o aceita) ‚Üí 2 vers√µes"
          - "Reconhecimento firma: aplicar ONDE exigido"
          - "Apostilamento: aplicar se QUALQUER cart√≥rio exigir"
          - "Anexar: contrato social holding, certid√µes, ITBI"
        output: "Pacote docs POR CART√ìRIO, uniformizado"
        example: |
          Cart√≥rio 1¬∫ SP: Escritura v1 (com reconhecimento) + Certid√µes apostiladas + ITBI
          Cart√≥rio 2¬∫ Guar: Escritura v2 (sem reconhecimento) + Certid√µes apostiladas
          Cart√≥rio √önico SA: Escritura v1 (com reconhecimento) + Certid√µes apostiladas + ITBI

  - phase: 3
    name: "Protocolo Simult√¢neo"
    duration_days: 23
    objective: "Protocolar TODOS cart√≥rios no MESMO DIA + acompanhamento paralelo"

    steps:
      - id: step_8
        name: "Agendamento Coordenado"
        responsible: holding-familiar-agent
        duration_days: 3
        dependencies: [step_7]
        actions:
          - "Agendar protocolo em TODOS cart√≥rios para MESMO DIA:"
          - "  - Exemplo: Segunda 10h (hor√°rio fixo)"
          - "  - Dividir equipe paralegal:"
          - "    - Paralegal A ‚Üí Cart√≥rio 1¬∫ SP"
          - "    - Paralegal B ‚Üí Cart√≥rio 2¬∫ Guarulhos"
          - "    - Paralegal C ‚Üí Cart√≥rio √önico Santo Andr√©"
          - "Protocolar simultaneamente (evita cart√≥rio saber que outro processou)"
        output: "Todos cart√≥rios protocolados MESMO DIA"
        rationale: |
          PROTOCOLO SIMULT√ÇNEO EVITA:
          - Um cart√≥rio rejeitar porque outro j√° processou (?)
          - Prazo = MAX(cart√≥rios), n√£o SOMA(cart√≥rios)

      - id: step_9
        name: "Acompanhamento Paralelo"
        responsible: holding-familiar-agent
        duration_days: 30
        dependencies: [step_8]
        actions:
          - "Cada cart√≥rio processa em paralelo (n√£o sequencial)"
          - "Acompanhar todos simultaneamente:"
          - "  - Cart√≥rio 1: an√°lise OK, prazo 20 dias"
          - "  - Cart√≥rio 2: pend√™ncia doc X, resolver < 5 dias"
          - "  - Cart√≥rio 3: an√°lise OK, prazo 25 dias"
          - "Resolver pend√™ncias POR CART√ìRIO individualmente"
        output: "Todos cart√≥rios processando em paralelo"
        timeline: "Prazo total = MAX(prazos cart√≥rios), n√£o SOMA"

      - id: step_10
        name: "Registro Conclu√≠do (Todos Cart√≥rios)"
        responsible: holding-familiar-agent
        duration_days: 0
        dependencies: [step_9]
        actions:
          - "Validar TODOS cart√≥rios conclu√≠ram registro"
          - "Baixar matr√≠culas atualizadas (propriet√°rio = Holding)"
          - "Arquivar documenta√ß√£o completa"
        output: "Holding constitu√≠da + im√≥veis transferidos"
        celebration: |
          üéâ HOLDING FAMILIAR CONCLU√çDA!
          Retrabalho: 0% (framework anti-retrabalho funcionou)

results_framework_anti_retrabalho:
  before:
    retrabalho: "100% (todos casos tinham que refazer docs)"
    motivo: "Cart√≥rios n√£o uniformizados, protocolo sequencial sem mapeamento"
    prazo: "60-90 dias (com retrabalho adicional)"

  after:
    retrabalho: "20% (apenas casos edge com mudan√ßas inesperadas)"
    motivo: "Mapeamento pr√©vio + uniformiza√ß√£o + protocolo simult√¢neo"
    prazo: "45-60 dias (sem retrabalho)"
    comprovacao: "Validado em dezenas de holdings Grupo GROW"

timeline_summary:
  fase_1_mapeamento: "5-7 dias"
  fase_2_uniformizacao: "10-15 dias"
  fase_3_protocolo: "30-40 dias (cart√≥rios processando)"
  total: "45-62 dias (1,5-2 meses)"

costs_summary:
  holding_junta: "R$ 1.000 - R$ 3.000"
  certidoes: "R$ 1.000 - R$ 6.000 (15-30 certid√µes √ó R$ 50-200)"
  reconhecimentos: "R$ 300 - R$ 1.500 (varia quantidade)"
  apostilamentos: "R$ 500 - R$ 2.000 (se necess√°rio)"
  itbi: "R$ 15.000 - R$ 150.000 (MUITO vari√°vel, 2-3% valor im√≥veis)"
  taxas_cartorios: "R$ 3.000 - R$ 15.000 (varia cart√≥rio e valor im√≥veis)"
  total_estimado: "R$ 20.800 - R$ 177.500 (ITBI = maior custo)"

risks:
  risk_1:
    name: "Cart√≥rio muda requisitos ap√≥s mapeamento"
    probability: "10%"
    impact: "MEDIUM (retrabalho parcial)"
    mitigation: "Mapear < 30 dias antes protocolo (requisitos frescos)"

  risk_2:
    name: "ITBI surpresa alto (cliente desiste)"
    probability: "15%"
    impact: "CRITICAL (projeto cancela)"
    mitigation: "Calcular ITBI step_6, validar com cliente ANTES prosseguir"

  risk_3:
    name: "Banco n√£o autoriza transfer√™ncia (im√≥vel financiado)"
    probability: "20%"
    impact: "CRITICAL (im√≥vel fica fora holding)"
    mitigation: "Validar step_1 SE financiado, consultar banco ANTES"

success_metrics:
  - "Retrabalho < 20% (vs 100% antes framework)"
  - "Protocolo simult√¢neo todos cart√≥rios MESMO DIA"
  - "Prazo total < 60 dias (target 45 dias)"
  - "Cliente informado custo ITBI antes step_8"

heuristics:
  - id: "HF_HEU_001"
    rule: |
      SE holding familiar E m√∫ltiplos im√≥veis E m√∫ltiplos cart√≥rios
      ENT√ÉO ‚Üí OBRIGAT√ìRIO executar Framework Anti-Retrabalho (3 fases)
    rationale: "100% ‚Üí 20% retrabalho comprovado Grupo GROW"

  - id: "HF_HEU_002"
    rule: |
      SE Fase 1 identificou 5+ cart√≥rios diferentes
      ENT√ÉO ‚Üí Alertar cliente: complexidade ALTA, prazo pode estender
    rationale: "Mais cart√≥rios = mais requisitos divergentes"

  - id: "HF_HEU_003"
    rule: |
      SE ITBI > R$ 50.000
      ENT√ÉO ‚Üí PARAR step_7 + validar com cliente disposi√ß√£o pagar
    rationale: "ITBI alto pode inviabilizar holding"

integrations:
  junta_comercial_agent:
    task: "Constituir holding (step_4)"

  certidoes_compliance_agent:
    task: "Coletar todas certid√µes (step_5)"

  gestta:
    sync: "Tarefas holding aparecem no Gestta"

  onvio:
    comunicacao: "Updates semanais cliente (segundas 9h)"
    template: |
      üè† Holding Familiar - Status
      Fase: [1-Mapeamento / 2-Uniformiza√ß√£o / 3-Protocolo]
      Cart√≥rios envolvidos: [N]
      ITBI estimado: R$ [X]
      Pr√≥xima a√ß√£o: [descri√ß√£o]

  lexio:
    assinatura: "Escrituras assinadas digitalmente"
