# Agent Orchestration Design

**Generated by:** @barry-hawkins
**Task:** design-agent-orchestration
**Workflow:** wf-validate-ai-agents (phase_2)
**Date:** {date}
**Based on:** Agent Topology Assessment from @matthew-skelton

---

## 1. Agent Boundary Matrices

### {agent_name}

```yaml
agent:
  name: "{agent_name}"
  type: "{stream-aligned|platform|enabling|complicated-subsystem|orchestrator}"
  can_do:
    - "{autonomous_action_1}"
    - "{autonomous_action_2}"
  cannot_do:
    - "{forbidden_action_1}"
    - "{forbidden_action_2}"
  requires_approval:
    - "{gated_action_1}"
    - "{gated_action_2}"
  escalation_path: "{who_to_escalate_to}"
```

_(Repeat for each agent)_

---

## 2. Orchestration Flow

```
{flow_diagram}

Example:
@analyst ──▶ @architect ──▶ @dev ──▶ @qa
                                      │
                                      ├── PASS ──▶ @pm (success)
                                      └── FAIL ──▶ @architect (feedback, max 3 iterations)
```

**Pattern:** {sequential|parallel|hierarchical|conditional|mixed}

---

## 3. Handoff Protocols

| # | From | To | Artifact | Format | Validation | On Invalid |
|---|------|-----|----------|--------|-----------|-----------|
| 1 | @{agent} | @{agent} | {artifact} | {format} | {validation} | {action} |
| 2 | @{agent} | @{agent} | {artifact} | {format} | {validation} | {action} |

---

## 4. Human-in-the-Loop Gates

| # | Gate | Location | Trigger | Required Action |
|---|------|----------|---------|----------------|
| 1 | {gate_name} | After @{agent} | {trigger} | {approve/reject/modify} |
| 2 | {gate_name} | After @{agent} | {trigger} | {approve/reject/modify} |

---

## 5. Safety Constraints

```yaml
safety:
  input_validation: "{rule}"
  output_validation: "{rule}"
  scope_enforcement: "{rule}"
  resource_limits:
    token_limit: {n}
    time_limit: "{duration}"
    retry_limit: {n}
  audit_logging: "{what_is_logged}"
```

---

## 6. FMEA (Failure Mode and Effects Analysis)

| # | Failure Mode | Effect | Likelihood | Severity | Mitigation | Recovery |
|---|-------------|--------|-----------|----------|-----------|----------|
| 1 | {failure} | {effect} | {H/M/L} | {Critical/Major/Minor} | {mitigation} | {recovery} |
| 2 | {failure} | {effect} | {H/M/L} | {Critical/Major/Minor} | {mitigation} | {recovery} |

---

## 7. Cascade Prevention

| Mechanism | Description | Trigger |
|-----------|------------|---------|
| Circuit breaker | {description} | {n} failures |
| Bulkhead | {description} | Agent isolation |
| Timeout | {description} | {duration} |
| Fallback | {description} | Agent unavailable |

---

## Handoff

**Next Specialist:** @yoav-shoham
**Task:** validate-agent-protocols
**Context Passed:**
- Agent boundary matrices (Section 1)
- Orchestration flow (Section 2)
- Handoff protocols (Section 3)
- Safety constraints (Section 5)
- FMEA report (Section 6)

---

_Design generated by @barry-hawkins using design-agent-orchestration task_
