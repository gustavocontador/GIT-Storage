# wf-mapa-cervejaria.yaml
# Workflow completo: Registro MAPA para cervejarias
# Owner: mapa-licencas-agent
# Duration: 180 dias (6 meses)
# Criticality: HIGH (processo #1 mais problem√°tico do Grupo GROW)

name: "MAPA Cervejaria - Registro Completo"
id: wf-mapa-cervejaria
version: "1.0.0"
owner: mapa-licencas-agent
type: paralegal-workflow
duration_days: 180
complexity: high

description: |
  Workflow completo para registro de cervejaria no MAPA (Minist√©rio da Agricultura).
  11 steps sequenciais + paralelo com licen√ßa ambiental (coordena√ß√£o cr√≠tica).
  Baseado em dezenas de processos reais do Grupo GROW.

prerequisites:
  - empresa_registrada: "Empresa registrada na Junta Comercial (CNPJ ativo)"
  - cnae: "CNAE 1113-5/01 (Fabrica√ß√£o de cervejas e chopes)"
  - imovel: "Im√≥vel identificado (pr√≥prio ou alugado)"
  - capital: "Capital social m√≠nimo R$ 50.000"

coordination:
  critical_parallel: |
    EXECUTAR EM PARALELO (n√£o sequencial):
    - Workflow MAPA (este)
    - Workflow Licen√ßa Ambiental (wf-licenca-ambiental.yaml)

    ECONOMIA: 3-6 meses executando paralelo vs sequencial.
    AGENTE COORDENADOR: licencas-ambientais-agent

phases:
  - phase: 1
    name: "Documenta√ß√£o Inicial"
    duration_days: 30
    steps:
      - id: step_1
        name: "Contrato Social + Registro Junta"
        responsible: junta-comercial-agent
        duration_days: 5
        actions:
          - "Validar contrato social: objeto social inclui fabrica√ß√£o cerveja"
          - "CNAE correto: 1113-5/01"
          - "Capital social: m√≠nimo R$ 50k (recomendado R$ 100k+)"
          - "Registro Junta Comercial: NIRE obtido"
        output: "Contrato social registrado + NIRE"
        blockers:
          - "Empresa n√£o registrada ‚Üí coordenar com junta-comercial-agent"

      - id: step_2
        name: "Respons√°vel T√©cnico (Engenheiro Alimentos)"
        responsible: mapa-licencas-agent
        duration_days: 10
        actions:
          - "Contratar engenheiro de alimentos (registro CREA/CFT ativo)"
          - "ART (Anota√ß√£o Responsabilidade T√©cnica) ou RRT"
          - "RT assina documentos t√©cnicos MAPA"
        output: "ART/RRT + contrato RT"
        cost: "R$ 2.000 - R$ 5.000/m√™s (honor√°rios RT)"
        critical: |
          SEM RT habilitado = pedido MAPA negado.
          RT deve acompanhar TODO o processo (vistorias, ajustes).

      - id: step_3
        name: "Memorial Descritivo F√°brica"
        responsible: mapa-licencas-agent
        responsible_external: "Engenheiro Alimentos (RT)"
        duration_days: 15
        actions:
          - "Planta baixa f√°brica (layout equipamentos)"
          - "Fluxograma produ√ß√£o (malte ‚Üí mostura ‚Üí fervura ‚Üí fermenta√ß√£o ‚Üí envase)"
          - "Capacidade produ√ß√£o (litros/m√™s)"
          - "Equipamentos (brassagem, fermentadores, envase)"
          - "Manual Boas Pr√°ticas Fabrica√ß√£o (BPF)"
        output: "Memorial descritivo completo + ART engenheiro"
        dependencies:
          - "Im√≥vel definido (endere√ßo, metragem)"
          - "Equipamentos especificados (mesmo que n√£o comprados ainda)"

  - phase: 2
    name: "Licen√ßas Pr√©vias (Paralelas)"
    duration_days: 60
    parallel_execution: true
    note: |
      Steps 4-6 executam EM PARALELO com licen√ßa ambiental.
      Coordenar com licencas-ambientais-agent.

    steps:
      - id: step_4
        name: "Alvar√° Sanit√°rio (VISA)"
        responsible: alvara-licencas-agent
        duration_days: 45
        actions:
          - "Adequar im√≥vel (piso lav√°vel, paredes lisas, ilumina√ß√£o)"
          - "Protocolar pedido VISA municipal"
          - "Vistoria VISA (agendada ap√≥s protocolo)"
          - "SE aprovado ‚Üí Alvar√° Sanit√°rio emitido"
        output: "Alvar√° Sanit√°rio v√°lido"
        cost: "R$ 500 - R$ 2.000 (taxa + adequa√ß√µes)"
        blockers:
          - "Im√≥vel n√£o adequado ‚Üí vistoria reprova ‚Üí 30-60d extras"

      - id: step_5
        name: "Alvar√° Funcionamento Municipal"
        responsible: alvara-licencas-agent
        duration_days: 30
        dependencies: [step_4]
        actions:
          - "Protocolar alvar√° funcionamento (prefeitura)"
          - "Zoneamento: validar endere√ßo permite ind√∫stria"
          - "Aguardar an√°lise t√©cnica prefeitura"
        output: "Alvar√° funcionamento emitido"
        cost: "R$ 500 - R$ 3.000 (varia munic√≠pio)"

      - id: step_6
        name: "Licen√ßa Ambiental (LP ‚Üí LI ‚Üí LO)"
        responsible: licencas-ambientais-agent
        duration_days: 180
        parallel: true
        note: |
          EXECUTAR EM PARALELO COM MAPA (n√£o esperar MAPA terminar).
          Ver wf-licenca-ambiental.yaml para detalhes.

          Timeline:
          - LP (Licen√ßa Pr√©via): 60-90 dias
          - LI (Licen√ßa Instala√ß√£o): 60-90 dias
          - LO (Licen√ßa Opera√ß√£o): 30-60 dias
          TOTAL: 150-240 dias (overlap com MAPA)

        output: "LO (Licen√ßa Opera√ß√£o) emitida"
        cost: "R$ 5.000 - R$ 20.000 (estudos + taxas)"
        critical: |
          Licen√ßa ambiental PODE SER MAIS LONGA QUE MAPA.
          Por isso PARALELO √© obrigat√≥rio.

  - phase: 3
    name: "Protocolo MAPA"
    duration_days: 60
    steps:
      - id: step_7
        name: "Cadastro SIPEAGRO"
        responsible: mapa-licencas-agent
        duration_days: 5
        actions:
          - "Acessar sistema SIPEAGRO (MAPA)"
          - "Criar usu√°rio empresa (certificado digital obrigat√≥rio)"
          - "Preencher cadastro estabelecimento"
        output: "Cadastro SIPEAGRO ativo"
        tech_requirement: "Certificado digital A1/A3 (via Lexio)"

      - id: step_8
        name: "Upload Documenta√ß√£o SIPEAGRO"
        responsible: mapa-licencas-agent
        duration_days: 10
        dependencies: [step_1, step_2, step_3, step_4, step_5, step_6, step_7]
        actions:
          - "Upload contrato social + NIRE"
          - "Upload ART/RRT engenheiro"
          - "Upload memorial descritivo + plantas"
          - "Upload alvar√° sanit√°rio"
          - "Upload alvar√° funcionamento"
          - "Upload licen√ßa ambiental (LO)"
          - "Preencher formul√°rios espec√≠ficos MAPA"
        output: "Processo MAPA protocolado"
        validation: |
          VALIDAR TODOS DOCS ANTES UPLOAD:
          - PDFs leg√≠veis (n√£o fotos distorcidas)
          - Assinaturas digitais v√°lidas
          - Datas atualizadas (certid√µes < 90 dias)

      - id: step_9
        name: "An√°lise Documental MAPA"
        responsible: mapa-licencas-agent
        duration_days: 45
        note: "BLACK BOX - MAPA analisa internamente"
        possible_outcomes:
          - outcome_1:
              status: "Aprovado sem pend√™ncias"
              next: "Avan√ßar step_10"
          - outcome_2:
              status: "Pend√™ncias documentais"
              action: "Complementar docs + aguardar nova an√°lise (10-20 dias extras)"
          - outcome_3:
              status: "Rejeitado (erro grave)"
              action: "Corrigir + reprotocolar (pode adicionar 60+ dias)"
        output: "An√°lise conclu√≠da: aprovado ou pend√™ncias"

  - phase: 4
    name: "Finaliza√ß√£o"
    duration_days: 30
    steps:
      - id: step_10
        name: "Vistoria MAPA (Presencial)"
        responsible: mapa-licencas-agent
        responsible_external: "Fiscal MAPA"
        duration_days: 20
        dependencies: [step_9]
        actions:
          - "MAPA agenda vistoria in loco (pode demorar 10-30 dias agendar)"
          - "Fiscal verifica: equipamentos, higiene, fluxo produ√ß√£o, BPF"
          - "RT (engenheiro) DEVE estar presente"
          - "SE aprovado ‚Üí Relat√≥rio vistoria positivo"
          - "SE reprovado ‚Üí Listar n√£o-conformidades + nova vistoria (30-60d)"
        output: "Relat√≥rio vistoria aprovado"
        critical: |
          F√°brica DEVE ESTAR 100% PRONTA para vistoria:
          - Equipamentos instalados e funcionando
          - Higieniza√ß√£o impec√°vel
          - Manual BPF vis√≠vel e seguido
          - RT presente para explicar processos

      - id: step_11
        name: "Emiss√£o Registro MAPA"
        responsible: mapa-licencas-agent
        duration_days: 10
        dependencies: [step_10]
        actions:
          - "MAPA emite SIF (Servi√ßo Inspe√ß√£o Federal) ou SIE (Estadual)"
          - "N√∫mero registro: formato XXX/YYYY (ex: 123/2025)"
          - "Certificado registro (PDF + f√≠sico via correios)"
        output: "Registro MAPA ativo - PODE PRODUZIR E VENDER"
        celebration: |
          üéâ CERVEJARIA OFICIALMENTE REGISTRADA!
          Pode iniciar produ√ß√£o comercial.

timeline_summary:
  optimistic: "150 dias (5 meses) - tudo OK primeira tentativa"
  realistic: "180 dias (6 meses) - 1-2 rodadas pend√™ncias"
  pessimistic: "240 dias (8 meses) - vistoria reprova + retrabalho"

costs_summary:
  rt_honorarios: "R$ 12.000 - R$ 30.000 (6 meses √ó R$ 2k-5k/m√™s)"
  memorial_descritivo: "R$ 3.000 - R$ 5.000"
  alvara_sanitario: "R$ 500 - R$ 2.000"
  alvara_funcionamento: "R$ 500 - R$ 3.000"
  licenca_ambiental: "R$ 5.000 - R$ 20.000"
  taxas_mapa: "R$ 1.000 - R$ 3.000"
  adequacao_imovel: "R$ 10.000 - R$ 50.000 (varia muito)"
  total_estimado: "R$ 32.000 - R$ 113.000"

risks:
  risk_1:
    name: "Vistoria MAPA reprova"
    probability: "30%"
    impact: "HIGH (+30-60 dias)"
    mitigation: "RT experiente + checklist pr√©-vistoria interna"

  risk_2:
    name: "Licen√ßa ambiental atrasa (mais que MAPA)"
    probability: "40%"
    impact: "CRITICAL (bloqueia step_8)"
    mitigation: "PARALELO desde day 1 (coordenar com licencas-ambientais-agent)"

  risk_3:
    name: "Im√≥vel inadequado (zoneamento/estrutura)"
    probability: "20%"
    impact: "CRITICAL (precisa mudar im√≥vel, restart)"
    mitigation: "Validar zoneamento + estrutura ANTES step_1"

success_metrics:
  - "Registro MAPA emitido em < 180 dias (target)"
  - "Zero retrabalho documental (docs corretos primeira vez)"
  - "Vistoria MAPA aprovada primeira tentativa"
  - "Licen√ßa ambiental N√ÉO bloqueia MAPA (paralelo OK)"

integrations:
  gestta:
    sync: "Tarefas MAPA aparecem no Gestta (sistema cont√°bil)"
    bi_directional: true

  onvio:
    comunicacao: "Updates semanais cliente via WhatsApp (segundas 9h)"
    template: |
      üìä MAPA Cervejaria - Status Semana
      Etapa: [X] de 11 ([%] conclu√≠do)
      Esta semana: [A√ß√£o realizada]
      Pr√≥xima semana: [Pr√≥xima a√ß√£o]
      Prazo estimado conclus√£o: [DD/MM/AAAA]

  lexio:
    assinatura: "Documentos assinados digitalmente (memorial, contratos)"

alerts:
  - trigger: "step_9 pend√™ncias detectadas"
    action: "Alerta paralegal + RT: resolver pend√™ncias < 7 dias"
    priority: HIGH

  - trigger: "step_10 vistoria agendada"
    action: "Alerta 7 dias antes: checklist pr√©-vistoria"
    priority: CRITICAL

  - trigger: "Licen√ßa ambiental > 150 dias E MAPA step_7"
    action: "Alerta: licen√ßa pode bloquear MAPA, escalar"
    priority: HIGH
